<!--card template-->
<ng-container *ngIf="proposal">
    <!--card start-->
    <div (click)="toggleDetails()" style="top: calc(1rem * 1);" [ngClass]="{'bg-gray-100': showDetails}"
        class="sticky w-full max-w-xl px-8 py-12 mx-auto space-y-4 bg-white border rounded-lg shadow-lg">
        <p class="text-sm text-gray-500">Proposal ID: {{proposal._id}}</p>
        <h2 class="space-y-1 text-2xl font-bold leading-none text-gray-900 flex justify-between items-center">
            <span *ngIf="project" class="block py-2 mr-2">{{project.projectTitle}}</span>
            <span class="block w-fit p-2 border-2 border-transparent rounded-md text-white" [ngClass]="{'bg-blue-500': proposal.status === 'DRAFT',
                      'bg-yellow-500': proposal.status === 'PENDING',
                      'bg-red-500': proposal.status === 'REJECTED',
                      'bg-green-500': proposal.status === 'ACCEPTED'}">
                {{proposal.status}}</span>
        </h2>
    </div>
    <!--card end-->
    <!--card details start-->
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-30" *ngIf="showDetails">
        <div class="bg-white rounded-lg shadow-lg p-8 max-w-3xl w-full" style="max-height: 90vh; overflow-y: auto;">
            <div class="flex justify-between align-middle">
                <h2 *ngIf="project" class="text-2xl font-bold mb-4">{{project.projectTitle}}</h2>
                <button (click)="toggleDetails()"
                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold rounded-full p-1 items-center w-fit h-fit">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div class="flex justify-start align-middle">
                <p class="text-sm text-gray-500">Project ID: {{proposal.projectId}} |</p>
                <p class="text-sm text-gray-500 ml-1"> Proposal ID: {{proposal._id}}</p>
            </div>

            <div *ngIf="detailedProposal" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <p><strong>Created by:</strong> {{creatorName}}</p>
                    <p><strong>Project created by:</strong> {{projectCreatorName}}</p>
                    <p><strong>Description:</strong> <br> {{detailedProposal.coverLetter}}</p>
                </div>
                <div>
                    <ng-container *ngIf="detailedProposal.pricingType == 'BUDGET'">
                        <p>
                            <strong>Budget:</strong>
                            {{detailedProposal.proposedBudget}}
                        </p>
                    </ng-container>

                    <ng-container *ngIf="detailedProposal.pricingType == 'HOURLY_RATE'">
                        <p>
                            <strong>Hourly rate:</strong>
                            {{detailedProposal.proposedHourlyRate}}
                        </p>
                    </ng-container>

                    <p><strong>Estimated duration:</strong> {{detailedProposal.estimatedDuration}}</p>
                    <p><strong>Proposal status:</strong> {{detailedProposal.status}}</p>
                </div>
            </div>

            <!--Buttons start-->
            <div class="mt-4 flex w-full space-x-4">
                <ng-container *ngIf="userRole == 'FREELANCER'">
                    <button *ngIf="proposal.status === 'DRAFT'" (click)="sendProposal()"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded w-full">
                        Send Proposal
                    </button>
                    <button (click)="cancelProposal()"
                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded w-full">
                        Cancel Proposal
                    </button>
                    <button *ngIf="proposal.status !== 'ACCEPTED'" (click)="editProposal()"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full">
                        Edit Proposal
                    </button>
                </ng-container>

                <ng-container *ngIf="userRole == 'CLIENT'">
                    <button *ngIf="proposal.status === 'PENDING'" (click)="acceptProposal()"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full">
                        Accept Proposal
                    </button>
                    <button *ngIf="proposal.status === 'PENDING'" (click)="rejectProposal()"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full">
                        Reject Proposal
                    </button>
                    <button *ngIf="proposal.status === 'PENDING'" (click)="makeCounterProposal()"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full">
                        Make a Counter Proposal
                    </button>
                </ng-container>
            </div>
            <!--Buttons end-->
        </div>
    </div>
    <!--card details end-->
</ng-container>