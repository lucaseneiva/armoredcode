<div class="flex flex-col min-h-screen h-fit bg-white">

    <div *ngIf="isLoading" class="w-full flex justify-center items-center py-10 my-auto">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500"></div>
    </div>

    <ng-container *ngIf="!isLoading && profile">

        <div class="flex min-h-64 justify-start max-lg:justify-center items-center px-8 bg-slate-300 shadow-lg">
            <img *ngIf="profile.logo; else defaultImage" [src]="profile.logo" type="image/png" alt="Profile Logo"
                class="flex justify-center items-center bg-black rounded-full w-32 h-32 -mb-60 border-slate-300 border-4">
            <ng-template #defaultImage>
                <img src="../../../assets/images/prf_icon.png"
                    class="flex justify-center items-center bg-black rounded-full w-32 h-32 -mb-60 p-2 border-slate-300 border-4">
            </ng-template>
        </div>


        <div class="w-full flex max-lg:grid justify-between max-lg:justify-center py-3 mt-20 h-fit">
            <div class="px-10 max-lg:p-4 h-fit">
                <h2 class="font-bold text-3xl">
                    {{ profile.companyName ? profile.companyName : (profile.firstName ? profile.firstName + ' ' +
                    profile.lastName : 'User Profile') }}
                </h2>
                <h2>
                    ID: {{authService.getUserId()}}
                </h2>
            </div>
            <div class="flex justify-center max-lg:w-full max-lg:justify-between px-8 py-4 h-fit">
                <button (click)="showDeleteConfirmation()"
                    class="flex justify-center items-center rounded
                 max-lg:text-nowrap font-semibold text-gray-700 bg-transparent mr-2 py-4 px-8 border border-gray-500 hover:bg-red-500 hover:text-white hover:border-transparent">
                    <object class="w-3 h-3 mx-2" data="../../../assets/images/garbage-trash-svgrepo-com.svg"></object>
                    Delete Account
                </button>
                <button routerLink="/edit-profile"
                    class="flex justify-center items-center rounded max-lg:text-nowrap font-semibold
                         text-gray-700 bg-transparent ml-2 py-4 px-8 border border-gray-500 hover:bg-blue-500 hover:text-white hover:border-transparent">
                    <object class="w-3 h-3 mx-2 -mb-1"
                        data="../../../assets/images/pencil-edit-svgrepo-com.svg"></object>
                    Edit Profile
                </button>
            </div>
        </div>

        <div class="grid justify-center h-fit p-8 mb-8 border-t-2 ">
            <!--template start-->
            <ng-container *ngIf="profile.companyName; else freelancerContent">
                <!-- Client Profile Content -->
                <div class="w-full grid justify-center lg:px-32">
                    <h3 class="font-bold text-3xl py-3">About</h3>
                    <div class="w-full lg:flex max-lg:grid justify-between lg:space-x-32">
                        <p class="flex w-full justify-start text-xl py-3">{{ profile.companyDescription }}</p>

                        <ul class="block w-full justify-start text-xl py-3">
                            <li *ngIf="profile?.industryId"><strong>Industry:</strong> {{ industry?.name }}</li>
                            <li><strong>Company Size:</strong> {{ profile.companySize }}</li>
                            <li *ngIf="profile.location"><strong>Location:</strong>
                                {{ profile.location.city }}, {{ profile.location.country }}
                            </li>
                            <li *ngIf="profile.website"><span><strong>Website: </strong></span>
                                <a class="text-blue-500 hover:text-blue-600" [href]="profile.website" target="_blank">{{ profile.website }}</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- Client Profile Content -->
            </ng-container>

            <ng-template #freelancerContent>
                <!-- Freelancer Profile Content -->
                <div class="w-full grid justify-center lg:px-32">
                    <h3 class="font-bold text-3xl py-3">About</h3>
                    <div class="w-full lg:flex max-lg:grid justify-between lg:space-x-32">
                        <p class="flex w-full justify-start text-xl py-3">{{ profile.profileSummary }}</p>

                        <ul class="block w-full justify-start text-xl py-3 text-nowrap">
                            <li *ngIf="profile.specializationId" >
                                <strong>Specialization:</strong> {{ specialization }}
                            </li>
                            <li>
                                <strong>Experience Level:</strong> {{ profile.experienceLevel }}
                            </li>
                            <li *ngIf="profile.hourlyRate">
                                <strong>Hourly Rate:</strong>
                                {{ profile.hourlyRate.currency }}{{ profile.hourlyRate.min }} -
                                {{ profile.hourlyRate.currency }}{{ profile.hourlyRate.max }}
                            </li>
                            <li>
                                <strong>Availability:</strong> {{ profile.isAvailable ? 'Available' : 'Not Available' }}
                            </li>
                            <li *ngIf="profile.location">
                                <strong>Location:</strong> {{ profile.location.city }}, {{ profile.location.country }}
                            </li>
                        </ul>
                    </div>

                    <div *ngIf="profile.skillIds && profile.skillIds.length > 0">
                        <h4 class="font-bold text-2xl py-2">Skills</h4>
                        <ul class="flex flex-wrap justify-start gap-2"> 
                            <li *ngFor="let skillName of skills" 
                                class="flex w-fit h-fit justify-center align-middle text-nowrap text-white bg-blue-500 py-1 px-4 rounded-full"> <!-- Iterate over this.skills -->
                                {{ skillName }}
                            </li>
                        </ul>
                    </div>

                    <div class="lg:flex max-lg:grid lg:justify-between lg:space-x-32">
                        <div *ngIf="profile.portfolioItems && profile.portfolioItems.length > 0"
                            class="block w-full justify-start mt-4">
                            <h4 class="font-bold text-2xl h-fit">Portfolio</h4>
                            <ul class="text-xl">
                                <li *ngFor="let item of profile.portfolioItems" class="mt-2 align-top">
                                    <div class="flex space-x-2">
                                        <h2 class="font-bold">{{ item.title }} |</h2>
                                        <a class="text-blue-500 hover:text-blue-600 cursor-pointer">{{ item.url }}</a>
                                    </div>
                                    <p>{{ item.description }}</p>
                                </li>
                            </ul>
                        </div>

                        <div *ngIf="profile.workExperiences && profile.workExperiences.length > 0"
                            class="block w-full justify-start items-start mt-4">
                            <h4 class="font-bold text-2xl h-fit">Work Experience</h4>
                            <ul class="text-xl">
                                <li *ngFor="let work of profile.workExperiences" class="mt-2">
                                    {{ work.jobTitle }} at {{ work.companyName }} ({{ work.startDate | date:'MMM yyyy'
                                    }} -
                                    {{ work.endDate ? (work.endDate | date:'MMM yyyy') : 'Present' }})
                                    <p *ngIf="work.jobDescription">{{ work.jobDescription }}</p>
                                </li>
                            </ul>
                        </div>
                    </div>


                    <div class="lg:flex max-lg:grid lg:justify-between lg:space-x-32">
                        <div *ngIf="profile.educations && profile.educations.length > 0"
                            class="block w-full justify-start items-start mt-4">
                            <h4 class="font-bold text-2xl h-fit">Educations</h4>
                            <ul class="text-xl">
                                <li *ngFor="let edu of profile.educations" class="mt-2 align-top">
                                    {{ edu.degreeName }} in {{ edu.fieldOfStudy }} - {{ edu.institution }} ({{
                                    edu.startDate
                                    |
                                    date:'MMM/yyyy' }} - {{ edu.endDate ? (edu.endDate | date:'MMM/yyyy') : 'Present'
                                    }})
                                </li>
                            </ul>
                        </div>

                        <div *ngIf="profile.certifications && profile.certifications.length > 0"
                            class="block w-full justify-start items-start mt-4">
                            <h4 class="font-bold text-2xl h-fit">Certifications</h4>
                            <ul class="text-xl">
                                <li *ngFor="let cert of profile.certifications" class="mt-2 align-top">
                                    {{ cert.name }} - {{ cert.issuingOrganization }} 
                                    ({{ cert.issueDate | date:'MMM/yyyy'}})
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Freelancer Profile Content -->
            </ng-template>
            <!--template end-->
        </div>

    </ng-container>

    <ng-container *ngIf="!profile">
        <div class="block text-wrap max-w-md shadow-lg mt-56 p-10 mx-auto bg-white">
            <h1 class="text-center text-4xl text-gray-700">Such empty!</h1>
            <p class="text-left text-2xl text-gray-600 mt-4">
                You don't have a profile yet.
                but you can create one clicking in the "create Profile" button.
            </p>
        </div>

        <div class="fixed bottom-12 left-1/2 transform -translate-x-1/2">
            <button routerLink="/create-profile"
                class="bg-blue-500 hover:bg-blue-700 text-xl text-white font-bold py-4 px-8 rounded cursor-pointer">
                Create profile
            </button>
        </div>

    </ng-container>

    <!-- Confirmation Modal start-->
    <div *ngIf="showConfirmationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-lg p-6 w-96">
            <h2 class="text-xl font-bold mb-4">Are you sure you want to delete your account?</h2>
            <p class="mb-4">This action is irreversible. Your profile and data will be permanently deleted.</p>
            <div class="flex justify-center">
                <button (click)="handleConfirmation(false)"
                    class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 w-full rounded mx-1">
                    No
                </button>
                <button (click)="handleConfirmation(true)"
                    class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 w-full rounded mx-1">
                    Yes
                </button>
            </div>
        </div>
    </div>
    <!-- Confirmation Modal end-->
</div>